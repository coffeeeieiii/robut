<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tetris</title>
  <style>
    body { background:#111; display:flex; flex-direction:column; gap:10px;
           justify-content:center; align-items:center; height:100vh; margin:0; color:#eee; font-family:system-ui}
    canvas { background:#222; border:3px solid #fff; border-radius:10px }
    .row { display:flex; gap:14px; align-items:center }
    .badge{background:#2b2d31;padding:6px 10px;border-radius:10px}
    .btn{background:#ffd54a;color:#222;border:0;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
  </style>
</head>
<body>
  <div class="row">
    <div class="badge">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="score">0</span></div>
    <button id="restart" class="btn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
    <button id="pauseBtn">‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î</button>
    <div class="badge">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ:</div>
    <canvas id="next" width="100" height="100"></canvas>
  </div>
  <canvas id="game" width="200" height="400"></canvas>
  <div>‡∏õ‡∏∏‡πà‡∏°: ‚Üê ‚Üí ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô | ‚Üì ‡πÄ‡∏£‡πà‡∏á‡∏•‡∏á | ‚Üë ‡∏´‡∏°‡∏∏‡∏ô</div>
  <h3>üèÜ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h3>
  <ol id="highscores"></ol>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const nextCv = document.getElementById('next');
const nextCx = nextCv.getContext('2d');
const ROWS = 20, COLS = 10, SIZE = 20;

let board = Array.from({length: ROWS}, () => Array(COLS).fill(0));
let score = 0;
let paused = false;
let clearEffects = [];

const colors = ['#FFF0F5','#99FFFF','#CCFFCC','#c5e1a5','#dcedc8','#b3e5fc','#e1bee7','#f8bbd0'];

const shapes = [
  [], [[1,1,1,1]], [[1,1],[1,1]], [[0,1,0],[1,1,1]],
  [[1,0,0],[1,1,1]], [[0,0,1],[1,1,1]], [[1,1,0],[0,1,1]], [[0,1,1],[1,1,0]]
];

let piece = newPiece();
let nextPiece = newPiece();
let dropTimer = 0;
let dropInterval = 500;

document.getElementById('pauseBtn').onclick = () => {
  paused = !paused;
  document.getElementById('pauseBtn').textContent = paused ? "‚ñ∂Ô∏è ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠" : "‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î";
};

function newPiece(){
  const type = Math.floor(Math.random()*7)+1;
  const shape = shapes[type].map(r=>r.slice());
  return { shape, x:3, y:0, type };
}

function drawBlock(x,y,colorIndex){
  ctx.fillStyle = colors[colorIndex];
  ctx.fillRect(x*SIZE, y*SIZE, SIZE-1, SIZE-1);
}

function drawGhost(){
  let ghostY = piece.y;
  while(!collide(piece.shape, piece.x, ghostY + 1)){
    ghostY++;
  }

  ctx.globalAlpha = 0.25;
  for(let r=0;r<piece.shape.length;r++){
    for(let c=0;c<piece.shape[r].length;c++){
      if(piece.shape[r][c]) {
        drawBlock(piece.x + c, ghostY + r, piece.type);
      }
    }
  }
  ctx.globalAlpha = 1.0;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      if(board[r][c]) drawBlock(c,r,board[r][c]);
      else {ctx.fillStyle="#1a1a1a";ctx.fillRect(c*SIZE,r*SIZE,SIZE-1,SIZE-1);}
    }
  }
  drawGhost();
  for(let r=0;r<piece.shape.length;r++){
    for(let c=0;c<piece.shape[r].length;c++){
      if(piece.shape[r][c]) drawBlock(piece.x+c,piece.y+r,piece.type);
    }
  }
for (let i = clearEffects.length - 1; i >= 0; i--) {
    const eff = clearEffects[i];
    eff.timer--;
    ctx.fillStyle = `rgba(255,255,255,${Math.sin(eff.timer / 3) * 0.5 + 0.5})`;
    for (const r of eff.rows) {
      ctx.fillRect(0, r * SIZE, COLS * SIZE, SIZE);
    }
    if (eff.timer <= 0) clearEffects.splice(i, 1);
  }
}

function drawNextPreview(){
  nextCx.clearRect(0,0,nextCv.width,nextCv.height);
  const s = nextPiece.shape, color = colors[nextPiece.type];
  const offX = (nextCv.width - s[0].length*SIZE)/2;
  const offY = (nextCv.height - s.length*SIZE)/2;
  for(let r=0;r<s.length;r++){
    for(let c=0;c<s[r].length;c++){
      if(s[r][c]){nextCx.fillStyle=color;nextCx.fillRect(offX+c*SIZE,offY+r*SIZE,SIZE-1,SIZE-1);}
    }
  }
}

function collide(shape,x,y){
  for(let r=0;r<shape.length;r++){
    for(let c=0;c<shape[r].length;c++){
      if(shape[r][c]){
        let ny=y+r,nx=x+c;
        if(ny>=ROWS||nx<0||nx>=COLS||(ny>=0&&board[ny][nx])) return true;
      }
    }
  }
  return false;
}

function merge(){
  for(let r=0;r<piece.shape.length;r++){
    for(let c=0;c<piece.shape[r].length;c++){
      if(piece.shape[r][c]) board[piece.y+r][piece.x+c]=piece.type;
    }
  }
}

function clearLines(){
  let toClear = [];
  for (let r = ROWS - 1; r >= 0; r--) {
    if (board[r].every(v => v !== 0)) {
      toClear.push(r);
    }
  }
    if (toClear.length > 0) {
      clearEffects.push({ rows: toClear.slice(), timer: 15 });
      setTimeout(() => {
        for (const r of toClear) {
          board.splice(r, 1);
         board.unshift(Array(COLS).fill(0));
      }
      score += [0, 100, 300, 500, 800][toClear.length];
      scoreEl.textContent = score;
    }, 200);
  }
}
function rotate(){
  const ns = piece.shape[0].map((_,i)=>piece.shape.map(row=>row[i])).reverse();
  if(!collide(ns,piece.x,piece.y)) piece.shape=ns;
}

function softDrop(){
  if(!collide(piece.shape,piece.x,piece.y+1)) piece.y++;
  else{
    merge(); clearLines();
    piece = nextPiece; nextPiece = newPiece();
    if(collide(piece.shape,piece.x,piece.y)){
    saveHighScore(score);
      board = Array.from({length:ROWS},()=>Array(COLS).fill(0));
      score=0;scoreEl.textContent=score;
    }
  }
}

function moveLeft(){if(!collide(piece.shape,piece.x-1,piece.y)) piece.x--;}
function moveRight(){if(!collide(piece.shape,piece.x+1,piece.y)) piece.x++;}

let last=0;
function loop(ts){
  if(paused){draw();drawNextPreview();requestAnimationFrame(loop);return;}
  const dt=ts-last;last=ts;
  dropTimer+=dt;if(dropTimer>dropInterval){softDrop();dropTimer=0;}
  draw();drawNextPreview();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

document.addEventListener('keydown',e=>{
  const keys=['ArrowLeft','ArrowRight','ArrowDown','ArrowUp','x','X','z','Z'];
  if(keys.includes(e.key)) e.preventDefault();
  if(paused) return;
  if(e.key==='ArrowLeft') moveLeft();
  if(e.key==='ArrowRight') moveRight();
  if(e.key==='ArrowDown') softDrop();
  if(e.key==='ArrowUp'||e.key==='x'||e.key==='X') rotate();
  if(e.key==='z'||e.key==='Z'){rotate();rotate();rotate();}
});

document.getElementById('restart').onclick=()=>{
  saveHighScore(score);
  board=Array.from({length:ROWS},()=>Array(COLS).fill(0));
  score=0;scoreEl.textContent=score;
  piece=newPiece();nextPiece=newPiece();
  clearEffects = [];
  renderHighScores(); 
};

function saveHighScore(score){
  let scores = JSON.parse(localStorage.getItem('tetrisScores') || "[]");
  scores.push(score);
  scores.sort((a,b)=>b-a);
  scores = scores.slice(0,5);
  localStorage.setItem('tetrisScores', JSON.stringify(scores));
  renderHighScores();
}

function renderHighScores(){
  let scores = JSON.parse(localStorage.getItem('tetrisScores') || "[]");
  const list = document.getElementById('highscores');
  list.innerHTML = scores.map((s,i)=>`<li>#${i+1} : ${s} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</li>`).join('');
}

renderHighScores();

</script>
</body>
</html>
